<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GoBuy Nepal • Order Details</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
:root{
  --purple:#7a1ea1; --purple-700:#5b1680; --accent:#d35400;
  --bg:#f6f7fb; --card:#ffffff; --line:#e6e7ef; --ink:#1f2033; --muted:#7e8190;
  --ok:#2ecc71; --warn:#ff8a1f; --bad:#e74c3c; --blue:#3aa0ff;
  --shadow:0 12px 24px rgba(27,31,35,.06); --radius:14px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}

/* Layout */
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
@media (max-width:1024px){.app{grid-template-columns:72px 1fr}}
.sidebar{
  position:sticky; top:0; height:100vh; background:#fff; border-right:1px solid var(--line);
  display:flex; flex-direction:column; gap:10px; padding:14px 10px;
}
.brand{display:flex; align-items:center; gap:10px; padding:8px 8px 14px}
.brand img{width:36px;height:36px;object-fit:contain}
.brand .t{font-weight:900; letter-spacing:.2px; color:var(--purple)}
@media (max-width:1024px){ .brand .t{display:none} }

.nav{display:grid; gap:6px; margin-top:8px}
.nav a{
  display:grid; grid-template-columns:28px 1fr auto; align-items:center; gap:12px;
  padding:10px; border-radius:10px; color:#3b3d4d; text-decoration:none;
}
.nav a i{font-size:16px; color:var(--purple)}
.nav a:hover{background:#faf8ff}
.nav a.active{background:#f2e9ff; color:var(--purple); font-weight:800}
@media (max-width:1024px){
  .nav a{grid-template-columns:28px; justify-items:center}
  .nav a span, .nav a small{display:none}
}
.sidebar .spacer{flex:1}
.logout{color:var(--bad)!important}
.logout i{color:var(--bad)!important}

/* Main */
.main{display:flex; flex-direction:column; min-width:0}
.topbar{
  position:sticky; top:0; z-index:3; background:#fff; border-bottom:1px solid var(--line);
  display:flex; align-items:center; gap:12px; padding:10px 14px;
}
.breadcrumb{font-weight:900; color:#3c3270}
.top-actions{margin-left:auto; display:flex; gap:10px}

/* Action chips (match your screenshot) */
.act{
  border:1px solid var(--line);
  background:#fff;
  padding:10px 12px;
  border-radius:14px;
  font-weight:800;
  font-size:14px;
  display:inline-flex; align-items:center; gap:8px;
  cursor:pointer; text-decoration:none;
}
.act.purple{ color:var(--purple); border-color:#e7d8ff }
.act.orange{ color:#ff8a1f; border-color:#ffd9b5 }
.act.red{ color:#e74c3c; border-color:#ffd0d0 }
.act:hover{ background:#fafafa }
.act i{font-size:14px}

/* Content */
.content{padding:16px; display:grid; gap:16px}
.card{background:#fff; border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden}
.ch{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--line); font-weight:900}
.cb{padding:14px}

/* Key/Value */
.kv{display:grid; grid-template-columns:160px 1fr; gap:8px 16px}
.kv div:first-child{color:var(--muted)}

/* Pills */
.badge{display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:800; color:#fff}
.b-await{background:var(--warn)}
.b-paid{background:var(--ok)}
.b-ship{background:var(--blue)}
.b-cancel{background:#b83b3b}

/* Items table */
.table{width:100%; border-collapse:collapse}
.table th,.table td{padding:10px; border-bottom:1px solid var(--line); text-align:left}
.table th{font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.4px}

/* Timeline chips */
.timeline{display:flex; gap:10px; flex-wrap:wrap}
.chip{padding:6px 10px; border-radius:12px; font-weight:800; font-size:12px; color:#fff}
.c1{background:#6c40ad} .c2{background:#7a1ea1} .c3{background:#3aa0ff} .c4{background:#9aa0a6}
</style>
</head>
<body>

<div class="app">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <img src="assets/icons/gobuynepal-logo.png" alt="GoBuy Nepal"/>
      <div class="t">GoBuy Admin</div>
    </div>
    <nav class="nav">
      <a href="admin.html"><i class="fa-solid fa-gauge"></i><span>Dashboard</span></a>
      <a class="active" href="admin-orders.html"><i class="fa-solid fa-bag-shopping"></i><span>Orders</span></a>
      <a href="admin-chat.html"><i class="fa-solid fa-comments"></i><span>Chats</span></a>
      <a href="admin-cases.html"><i class="fa-regular fa-circle-question"></i><span>Cases</span></a>
      <a href="admin-customers.html"><i class="fa-regular fa-user"></i><span>Customers</span></a>
      <a href="admin-analytics.html"><i class="fa-solid fa-chart-line"></i><span>Analytics</span></a>
      <a href="admin-settings.html"><i class="fa-solid fa-gear"></i><span>Settings</span></a>
    </nav>
    <div class="spacer"></div>
    <a class="nav logout" href="index.html"><i class="fa-solid fa-right-from-bracket"></i><span>Sign out</span></a>
  </aside>

  <!-- Main -->
  <section class="main">

    <!-- Top bar -->
    <header class="topbar">
      <div class="breadcrumb" id="crumb">Order</div>
      <div class="top-actions">
        <a href="#details" class="act purple"><i class="fa-regular fa-eye"></i><span>Open<br>details</span></a>
        <button id="btnPaid" class="act orange"><i class="fa-solid fa-receipt"></i><span>Mark<br>paid</span></button>
        <button id="btnCancel" class="act red"><i class="fa-regular fa-circle-xmark"></i><span>Cancel</span></button>
      </div>
    </header>

    <div class="content" id="details">
      <!-- Summary -->
      <section class="card">
        <div class="ch">Summary</div>
        <div class="cb">
          <div class="kv">
            <div>Order ID</div><div id="oId">—</div>
            <div>Status</div><div id="oStatus">—</div>
            <div>Total</div><div id="oTotal">—</div>
            <div>Created</div><div id="oCreated">—</div>
          </div>
        </div>
      </section>

      <!-- Customer -->
      <section class="card">
        <div class="ch">Customer</div>
        <div class="cb">
          <div class="kv">
            <div>Name</div><div id="cName">—</div>
            <div>Email</div><div id="cEmail">—</div>
            <div>Phone</div><div id="cPhone">—</div>
            <div>Address</div><div id="cAddr">—</div>
          </div>
        </div>
      </section>

      <!-- Items -->
      <section class="card">
        <div class="ch">Items</div>
        <div class="cb">
          <table class="table" id="itemsTbl">
            <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Timeline -->
      <section class="card">
        <div class="ch">Timeline</div>
        <div class="cb">
          <div class="timeline" id="timeline">
            <!-- chips inserted -->
          </div>
        </div>
      </section>
    </div>
  </section>
</div>

<script>
/* -------- helpers -------- */
const $ = (s,ctx=document)=>ctx.querySelector(s);
function badge(status){
  const cls = status==='Paid' ? 'b-paid'
            : status==='Shipped' ? 'b-ship'
            : status==='Cancelled' ? 'b-cancel'
            : 'b-await';
  return `<span class="badge ${cls}">${status}</span>`;
}
function money(n){ return 'NPR ' + Number(n||0).toFixed(2); }
function fdate(iso){ const d = new Date(iso); return d.toLocaleString(); }

/* -------- load order from query/local/seed -------- */
const SEED = [
  {id:8101, customer:{name:'Kriti S'}, status:'Awaiting Payment', total:220.50, created:new Date().toISOString(), items:[{name:'Wireless earbuds', qty:1, price:220.50}]},
  {id:8102, customer:{name:'Roshan P'}, status:'Paid', total:99.00, created:new Date().toISOString(), items:[{name:'USB-C Cable', qty:3, price:33}]},
  {id:8103, customer:{name:'Mira L'}, status:'Shipped', total:340.10, created:new Date().toISOString(), items:[{name:'Keyboard', qty:2, price:170.05}]}
];

const params = new URLSearchParams(location.search);
const idParam = params.get('order');

function findOrder(id){
  const local = JSON.parse(localStorage.getItem('ADMIN_ORDERS')||'[]');
  let o = local.find(x=>String(x.id)===String(id));
  if(o) return o;
  o = SEED.find(x=>String(x.id)===String(id));
  if(o) return o;
  // fallback: first seed or a blank
  return SEED[0];
}
let ORDER = findOrder(idParam);

function saveLocalChange(mutator){
  const arr = JSON.parse(localStorage.getItem('ADMIN_ORDERS')||'[]');
  const idx = arr.findIndex(x=>String(x.id)===String(ORDER.id));
  if(idx>-1){ mutator(arr[idx]); localStorage.setItem('ADMIN_ORDERS', JSON.stringify(arr)); }
}

/* -------- render -------- */
function render(){
  $('#crumb').textContent = `Order #${ORDER.id}`;
  $('#oId').textContent = `#${ORDER.id}`;
  $('#oStatus').innerHTML = badge(ORDER.status||ORDER.payment?.status||'Awaiting Payment');
  $('#oTotal').textContent = money(ORDER.total || ORDER.charges?.total);
  $('#oCreated').textContent = fdate(ORDER.created || new Date());

  const c = ORDER.customer || {};
  $('#cName').textContent = c.name || '—';
  $('#cEmail').textContent = c.email || '—';
  $('#cPhone').textContent = c.phone || '—';
  $('#cAddr').textContent = c.address || '—';

  // Items
  const items = ORDER.items && ORDER.items.length ? ORDER.items : [{name:'Item', qty:1, price:ORDER.total||0}];
  const tbody = $('#itemsTbl tbody'); tbody.innerHTML='';
  items.forEach(it=>{
    const tr = document.createElement('tr');
    const sub = Number(it.qty||1)*Number(it.price||0);
    tr.innerHTML = `<td>${it.name}</td><td>${it.qty||1}</td><td>${money(it.price)}</td><td>${money(sub)}</td>`;
    tbody.appendChild(tr);
  });

  // Timeline (basic)
  const tl = $('#timeline'); tl.innerHTML='';
  tl.insertAdjacentHTML('beforeend', `<span class="chip c1">Order Placed</span>`);
  tl.insertAdjacentHTML('beforeend', `<span class="chip c2">Confirmed</span>`);
  tl.insertAdjacentHTML('beforeend', `<span class="chip c3">${ORDER.status==='Shipped'?'Shipped': 'Processing'}</span>`);
  tl.insertAdjacentHTML('beforeend', `<span class="chip c4">${ORDER.status==='Cancelled'?'Cancelled':'Delivered (pending)'}</span>`);

  // toggle Mark paid availability
  $('#btnPaid').style.display = (ORDER.status==='Awaiting Payment' || ORDER.payment?.status==='Awaiting Payment') ? 'inline-flex' : 'none';
  // if already cancelled, hide actions
  if(ORDER.status==='Cancelled'){
    $('#btnPaid').style.display='none';
  }
}
render();

/* -------- actions -------- */
$('#btnPaid').addEventListener('click', ()=>{
  ORDER.status='Paid';
  ORDER.payment = ORDER.payment||{}; ORDER.payment.status='Paid';
  saveLocalChange(o=>{ o.status='Paid'; o.payment=o.payment||{}; o.payment.status='Paid'; });
  alert(`Order #${ORDER.id} marked as paid.`);
  render();
});
$('#btnCancel').addEventListener('click', ()=>{
  if(!confirm(`Cancel Order #${ORDER.id}?`)) return;
  ORDER.status='Cancelled';
  saveLocalChange(o=>{ o.status='Cancelled'; });
  render();
});
</script>
</body>
</html>
