<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile</title>

  <!-- Icons (no downloads) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{
      --purple:#7a1ea1;
      --purple-700:#5b1680;
      --bg:#ffffff;
      --card:#f5f6fa;
      --line:#e5e7ef;
      --text:#1e1e1e;
      --muted:#7b7f88;
      --orange:#ff8a1f;
      --danger:#e74c3c;
      --radius:14px;
      --shadow:0 8px 18px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);padding-bottom:88px}

    .page{max-width:450px;margin:0 auto;padding-bottom:110px}
    /* Topbar */
    .topbar{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 14px 6px; position:sticky; top:0; background:#fff; z-index:3;
      border-bottom:1px solid var(--line);
    }
    .topbar .left,.topbar .right{width:64px;display:flex;align-items:center;gap:10px}
    .topbar .center{flex:1;text-align:center;font-weight:800;color:#444}
    .top-btn{color:var(--purple);font-size:18px;text-decoration:none}

    /* Username header */
    .hero{
      text-align:center;padding:14px 16px 8px;
    }
    .username{
      color:var(--purple);font-weight:900;letter-spacing:.6px;text-transform:uppercase;
      margin-bottom:6px;
    }
    .badge{
      display:inline-block;background:var(--orange);color:#fff;font-weight:800;
      font-size:12px;padding:4px 8px;border-radius:6px;
    }

    /* Section label */
    .section-title{
      font-size:12px;color:var(--muted);letter-spacing:.4px;text-transform:uppercase;
      margin:14px 16px 8px;
    }

    /* Card with rows */
    .card{
      background:var(--card);border-radius:12px;margin:0 12px 12px;box-shadow:var(--shadow);
      overflow:hidden;border:1px solid var(--line);
    }
    .row{
      display:flex;align-items:center;gap:12px;padding:14px 14px;border-bottom:1px solid var(--line);
      background:#fff;
    }
    .row:last-child{border-bottom:none}
    .row .l{
      width:26px;height:26px;border-radius:6px;background:#fafafa;border:1px solid var(--line);
      display:flex;align-items:center;justify-content:center;color:#5b5b5b;font-size:13px;
    }
    .row .m{flex:1}
    .row .m .t{font-weight:700}
    .row .r{color:#b0b3bb}
    .row.link{cursor:pointer}
    .row.link:active{background:#f7f7fb}

    /* switch */
    .switch{
      --w:46px; --h:26px; position:relative;width:var(--w);height:var(--h);background:#e5e5ea;border-radius:999px;
      transition:.2s; cursor:pointer; border:1px solid var(--line);
    }
    .switch::after{
      content:""; position:absolute; left:2px; top:2px; width:22px; height:22px; background:#fff; border-radius:50%;
      box-shadow:0 1px 3px rgba(0,0,0,.2); transition:.2s;
    }
    .switch.on{ background:var(--purple); border-color:var(--purple)}
    .switch.on::after{ left: calc(100% - 24px) }

    .logout{ color:var(--danger) }
    .logout .l{ color:var(--danger); border-color:#ffd6d6; background:#fff5f5}

    /* Bottom nav */
    .bottom-nav{
      position:fixed; left:0; right:0; bottom:0; background:#fff; border-top:1px solid var(--line);
      display:flex; justify-content:space-around; align-items:center; padding:8px 0; z-index:999;
      box-shadow:0 -2px 8px rgba(0,0,0,.05);
    }
    .nav-item{
      color:var(--purple); text-decoration:none; font-size:12px;
      display:flex; flex-direction:column; align-items:center;
    }
    .nav-item i{ font-size:20px; margin-bottom:4px }
    .nav-item.active span{ font-weight:800 }
  </style>
</head>
<body>

  <main class="page">

    <!-- Top bar -->
    <div class="topbar">
      <div class="left">
        <a class="top-btn" href="dashboard.html"><i class="fa-solid fa-chevron-left"></i></a>
      </div>
      <div class="center">My Profile</div>
      <div class="right"></div>
    </div>

    <!-- Username + plan -->
    <section class="hero">
      <div id="username" class="username">USERNAME</div>
      <span class="badge" id="planBadge">Basic</span>
    </section>

    <!-- Membership Plans -->
    <div class="section-title">Membership Plans</div>
    <div class="card">
      <div class="row link" id="manageMembership">
        <div class="l"><i class="fa-solid fa-rectangle-list"></i></div>
        <div class="m"><div class="t">Membership Management</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link" id="personalId">
        <div class="l"><i class="fa-regular fa-id-card"></i></div>
        <div class="m"><div class="t">Personal ID Info</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link" id="paymentsInfo">
        <div class="l"><i class="fa-regular fa-credit-card"></i></div>
        <div class="m"><div class="t">Payments info</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link" id="changePassword">
        <div class="l"><i class="fa-solid fa-lock"></i></div>
        <div class="m"><div class="t">Change Password</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link" id="pickupOptions">
        <div class="l"><i class="fa-solid fa-location-dot"></i></div>
        <div class="m"><div class="t">Pickup & Delivery Options</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>
    </div>

    <!-- App Settings -->
    <div class="section-title">App Settings</div>
    <div class="card">
      <div class="row">
        <div class="l"><i class="fa-regular fa-bell"></i></div>
        <div class="m"><div class="t">Notifications</div></div>
        <div class="r"><div id="notifSwitch" class="switch" role="switch" tabindex="0" aria-checked="false"></div></div>
      </div>

      <div class="row link" id="language">
        <div class="l"><i class="fa-solid fa-language"></i></div>
        <div class="m"><div class="t">Language</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link" id="faqs">
        <div class="l"><i class="fa-regular fa-circle-question"></i></div>
        <div class="m"><div class="t">FAQs</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link" id="learnMore">
        <div class="l"><i class="fa-regular fa-lightbulb"></i></div>
        <div class="m"><div class="t">Learn More</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link" id="terms">
        <div class="l"><i class="fa-regular fa-file-lines"></i></div>
        <div class="m"><div class="t">Terms & Policies</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>

      <div class="row link logout" id="logout">
        <div class="l"><i class="fa-solid fa-right-from-bracket"></i></div>
        <div class="m"><div class="t">Log Out</div></div>
        <div class="r"><i class="fa-solid fa-chevron-right"></i></div>
      </div>
    </div>

  </main>

  <!-- Bottom navigation -->
  <nav class="bottom-nav">
    <a class="nav-item" href="dashboard.html"><i class="fas fa-home"></i><span>Home</span></a>
    <a class="nav-item" href="explore.html"><i class="fas fa-compass"></i><span>Explore</span></a>
    <a class="nav-item" href="add-to-cart.html"><i class="fas fa-shopping-cart"></i><span>Cart</span></a>
    <a class="nav-item" href="alerts.html"><i class="fas fa-bell"></i><span>Alerts</span></a>
    <a class="nav-item active" href="profile.html"><i class="fas fa-user"></i><span>Profile</span></a>
  </nav>

  <!-- ==== Firebase-aware Profile Script (drop-in) ==== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
      getAuth, onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import {
      getFirestore, doc, getDoc
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // ---- Your Firebase project (customer-login-e5ecd) ----
    const firebaseConfig = {
      apiKey: "AIzaSyC5BOwwDRg46t2LmWp-z8gOXEoyATioSQM",
      authDomain: "customer-login-e5ecd.firebaseapp.com",
      projectId: "customer-login-e5ecd",
      storageBucket: "customer-login-e5ecd.appspot.com",
      messagingSenderId: "569269085839",
      appId: "1:569269085839:web:0192c9f28b8eb24ea2f2fa"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // DOM helpers
    const $ = (s) => document.querySelector(s);
    const usernameEl = $('#username');
    const planBadge  = $('#planBadge');

    // --- Notifications toggle (local persistence)
    (function notifToggle(){
      const sw = document.getElementById('notifSwitch');
      const saved = localStorage.getItem('gbn_notif') === 'on';
      if(saved){ sw.classList.add('on'); sw.setAttribute('aria-checked','true'); }

      const toggle = () => {
        const on = sw.classList.toggle('on');
        sw.setAttribute('aria-checked', on ? 'true' : 'false');
        localStorage.setItem('gbn_notif', on ? 'on' : 'off');
      };
      sw.addEventListener('click', toggle);
      sw.addEventListener('keydown', e => { if(e.key==='Enter'||e.key===' ') { e.preventDefault(); toggle(); }});
    })();

    // --- Simple routers for rows
    const routes = {
      manageMembership: 'membership.html',
      personalId: 'id-info.html',
      paymentsInfo: 'payments.html',
      changePassword: 'change-password.html',
      pickupOptions: 'pickup-delivery.html',
      language: 'language.html',
      faqs: 'faqs.html',
      learnMore: 'learn-more.html',
      terms: 'terms.html'
    };
    Object.entries(routes).forEach(([id, url]) => {
      const el = document.getElementById(id);
      if(el) el.addEventListener('click', ()=> location.href = url);
    });

    // --- Logout -> Firebase signOut
    document.getElementById('logout').addEventListener('click', async ()=>{
      if(!confirm('Log out from GoBuy Nepal?')) return;
      try {
        await signOut(auth);
      } finally {
        // After sign out, go to login; preserve return target
        location.href = 'index.html?next=' + encodeURIComponent('profile.html');
      }
    });

    // --- Auth state: get the currently signed-in user
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        // Not signed in -> bounce to login
        const here = location.pathname.split('/').pop() || 'profile.html';
        location.replace('index.html?next=' + encodeURIComponent(here));
        return;
      }

      // User is signed in
      const displayName =
        user.displayName?.trim() ||
        (user.email ? user.email.split('@')[0] : 'User');

      usernameEl.textContent = displayName.toUpperCase();
      usernameEl.title = user.email || displayName;

      // Optional: fetch plan from Firestore users/{uid}.plan
      try {
        const snap = await getDoc(doc(db, 'users', user.uid));
        const plan = snap.exists() ? (snap.data().plan || 'Basic') : (localStorage.getItem('gbn_plan') || 'Basic');
        planBadge.textContent = plan;
      } catch {
        // Fallback to local or Basic if Firestore not set up yet
        planBadge.textContent = localStorage.getItem('gbn_plan') || 'Basic';
      }
    });
  </script>
</body>
</html>
